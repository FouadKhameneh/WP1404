# راهنمای اطمینان از درست کار کردن پروژه

## ۱. اجرای بک‌اند و فرانت‌اند

### بک‌اند (ترمینال اول)
```bash
cd backend
pip install -r requirements.txt
python manage.py migrate
python manage.py runserver 0.0.0.0:8000
```
- باید پیام `Starting development server at http://0.0.0.0:8000/` را ببینید.

### فرانت‌اند (ترمینال دوم)
**PowerShell:**
```powershell
cd frontend
npm install
$env:NEXT_PUBLIC_API_BASE_URL="http://localhost:8000/api/v1"
npm run dev
```
**Bash:**
```bash
cd frontend
npm install
export NEXT_PUBLIC_API_BASE_URL=http://localhost:8000/api/v1
npm run dev
```
- باید پیام `Ready in ...` و آدرس `http://localhost:3000` را ببینید.

---

## ۲. چک‌لیست تست دستی

| مرحله | کار | نتیجه مورد انتظار |
|--------|-----|-------------------|
| 1 | مرورگر را باز کنید و بروید به **http://localhost:3000** | صفحهٔ اصلی با پس‌زمینه و دکمه‌های ورود / ثبت‌نام / داشبورد نمایش داده شود. |
| 2 | روی **ثبت‌نام** کلیک کنید و یک کاربر جدید بسازید (نام کاربری + رمز عبور حداقل ۸ کاراکتر) | بعد از ثبت‌نام به داشبورد منتقل شوید. |
| 3 | در داشبورد، کارت‌های آمار (کل پرونده‌ها، پرونده فعال، …) را ببینید | اگر دسترسی گزارش نداشته باشید ممکن است خطای ۴۰۳ ببینید؛ در غیر این صورت اعداد یا «—» نمایش داده می‌شود. |
| 4 | از منوی بالا روی **پرونده‌ها** کلیک کنید | لیست پرونده‌ها (خالی یا دارای ردیف) با استایل کارت نمایش داده شود. |
| 5 | **گزارش‌ها** و **تحت تعقیب** را باز کنید | گزارش به صورت JSON و لیست تحت تعقیب (خالی یا دارای ردیف) نمایش داده شود. |
| 6 | **بورد کارآگاه** را باز کنید؛ یک آیتم را بکشید و روی دیگری رها کنید | لینک بین دو آیتم رسم شود. دکمه «خروجی PNG» در صورت نصب بودن `html-to-image` تصویر ذخیره کند. |
| 7 | **مدارک** را باز کنید | لیست لینک‌های مدارک (خالی یا دارای ردیف) نمایش داده شود. |
| 8 | روی **خروج** کلیک کنید | به صفحهٔ اصلی برگردید. |
| 9 | دوباره **ورود** کنید با همان کاربر | وارد داشبورد شوید. |

---

## ۳. تست API مستقیم (اختیاری)

- **Swagger:** http://localhost:8000/api/docs/
- **ثبت‌نام از Swagger:** `POST /api/v1/identity/auth/register/` با بدنهٔ JSON (username, password, password_confirm و در صورت نیاز email, full_name).
- **ورود:** `POST /api/v1/identity/auth/login/` با `identifier` و `password`.
- توکن برگشتی را در «Authorize» قرار دهید و سایر APIها را امتحان کنید.

---

## ۴. اگر خطا دیدید

| مشکل | اقدام |
|------|--------|
| فرانت به بک‌اند وصل نمی‌شود | مقدار `NEXT_PUBLIC_API_BASE_URL` را در ترمینال فرانت‌اند تنظیم کنید و سرور را یک بار متوقف و دوباره با `npm run dev` اجرا کنید. |
| خطای ۴۰۳ روی گزارش‌ها | کاربر باید نقش/دسترسی `reports.view` داشته باشد. از ادمین Django یا API دسترسی‌ها نقش را به کاربر اختصاص دهید. |
| لیست پرونده‌ها خالی است | طبیعی است اگر هنوز پرونده یا شکایتی ثبت نشده؛ از API شکایت یا صحنه‌جرم ثبت کنید یا از ادمین. |
| پس‌زمینهٔ صفحهٔ اصلی لود نمی‌شود | به‌خاطر فیلتر یا محدودیت شبکه ممکن است تصویر Unsplash لود نشود؛ صفحه با گرادیان و متن باید قابل استفاده باشد. |

---

## ۵. ادمین Django (برای ساخت نقش و دسترسی)

```bash
cd backend
python manage.py createsuperuser
```
سپس بروید به http://localhost:8000/admin/ و با همان کاربر وارد شوید. از بخش Access می‌توانید نقش (مثلاً captain) و دسترسی (مثلاً reports.view) تعریف و به کاربران اختصاص دهید.
