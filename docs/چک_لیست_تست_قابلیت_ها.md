# چک‌لیست تست قابلیت‌ها — سامانه عملیات دیجیتال پلیس

**برگرفته از:** WP-F2025-Project.pdf  
**پروژه:** Police Digital Operations System (PDOS)

---

## پیش‌نیاز اجرا

```bash
# بک‌اند
cd backend
pip install -r requirements.txt
python manage.py migrate
python manage.py seed_test_data
python manage.py runserver 0.0.0.0:8000

# فرانت‌اند (ترمینال جدید)
cd frontend
$env:NEXT_PUBLIC_API_BASE_URL="http://localhost:8000/api/v1"
npm install
npm run dev
```

**آدرس‌ها:**  
- فرانت: http://localhost:3000  
- بک‌اند API: http://localhost:8000/api/v1/  
- Swagger: http://localhost:8000/api/docs/  
- ادمین: http://localhost:8000/admin/  

**اعتبار تست:** `admin` / `admin123` | `detective1` / `test1234` | `shaki1` / `test1234`

---

# چک‌پوینت ۱ — بک‌اند

## ۱. صفحه اصلی و آمار عمومی

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 1.1 | آمار بدون احراز هویت | `GET /api/v1/reports/landing-stats/` در مرورگر یا Postman | ☐ |
| 1.2 | بازگرداندن `closed_cases`, `staff_count`, `active_cases` | بررسی ساختار JSON پاسخ | ☐ |

## ۲. ثبت‌نام و ورود

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 2.1 | ثبت‌نام کاربر جدید | `POST /api/v1/identity/auth/register/` با username, password, email, phone, national_id, full_name | ☐ |
| 2.2 | ورود با username | `POST /api/v1/identity/auth/login/` با identifier و password | ☐ |
| 2.3 | ورود با ایمیل/تلفن/کد ملی | همان endpoint با مقادیر مختلف | ☐ |
| 2.4 | دریافت توکن پس از ورود | بررسی وجود `token` در پاسخ | ☐ |
| 2.5 | خروج | `POST /api/v1/identity/auth/logout/` با توکن | ☐ |
| 2.6 | کاربر جاری | `GET /api/v1/identity/auth/me/` با توکن | ☐ |

## ۳. تشکیل پرونده

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 3.1 | ثبت شکایت توسط شاکی | `POST /api/v1/cases/complaints/` با توکن شاکی | ☐ |
| 3.2 | بررسی کارآموز و ارسال به افسر | بررسی روند review/resubmit | ☐ |
| 3.3 | تشکیل پرونده صحنه جرم | `POST /api/v1/cases/scene-cases/` با توکن پلیس | ☐ |
| 3.4 | تأیید پرونده صحنه توسط مافوق | `POST /api/v1/cases/scene-cases/<id>/approve/` | ☐ |

## ۴. ثبت شواهد

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 4.1 | استشهاد شاهد | `POST /api/v1/evidence/cases/create/` با type مناسب | ☐ |
| 4.2 | شواهد زیستی/پزشکی | ثبت + تأیید coroner | ☐ |
| 4.3 | وسایل نقلیه | ثبت با پلاک یا شماره سریال | ☐ |
| 4.4 | مدارک شناسایی | ثبت با key-value | ☐ |
| 4.5 | سایر شواهد | ثبت با عنوان و توضیحات | ☐ |
| 4.6 | لینک مدارک به هم | `POST /api/v1/evidence/links/` | ☐ |
| 4.7 | تأیید پزشکی‌قانونی | `POST /api/v1/evidence/biological/<id>/coroner-decision/` | ☐ |

## ۵. حل پرونده و تحقیقات

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 5.1 | افزودن مظنون | `POST /api/v1/cases/cases/<id>/suspects/` | ☐ |
| 5.2 | ارزیابی مظنون (امتیاز ۱–۱۰) | `POST /api/v1/investigation/assessments/` و scores | ☐ |
| 5.3 | ارسال استدلال | `POST /api/v1/investigation/reasonings/` | ☐ |
| 5.4 | تأیید استدلال | `POST /api/v1/investigation/reasonings/<id>/approve/` | ☐ |
| 5.5 | دستور بازداشت | `POST /api/v1/investigation/arrest-orders/` | ☐ |
| 5.6 | تغییر وضعیت پرونده | `POST /api/v1/cases/cases/<id>/transition-status/` | ☐ |
| 5.7 | Captain برای سطح عادی / Chief برای بحرانی | بررسی RBAC | ☐ |

## ۶. محاکمه و قضایی

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 6.1 | ثبت رأی قاضی | endpoint قضایی | ☐ |
| 6.2 | ثبت مجازات | در verdict | ☐ |

## ۷. وضعیت مظنونین و تحت تعقیب

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 7.1 | لیست تحت تعقیب | `GET /api/v1/wanted/` | ☐ |
| 7.2 | رتبه‌بندی Most Wanted | فرمول max(Lj)·max(Di) | ☐ |
| 7.3 | آمار مجتمع و کلی | `GET /api/v1/reports/wanted-rankings/` و general | ☐ |

## ۸. پاداش (Rewards)

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 8.1 | ثبت نکته پاداش | `POST /api/v1/rewards/tips/` | ☐ |
| 8.2 | بررسی نکته توسط افسر و کارآگاه | `POST /api/v1/rewards/tips/<id>/review/` | ☐ |
| 8.3 | دریافت شناسه یکتا پس از تأیید | بررسی `reward_claim_id` در پاسخ | ☐ |
| 8.4 | تأیید ادعای پاداش | `POST /api/v1/rewards/verify-claim/` با کد ملی و claim_id | ☐ |

## ۹. پرداخت

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 9.1 | شروع پرداخت وثیقه/جریمه | `POST /api/v1/payments/initiate/` | ☐ |
| 9.2 | Callback درگاه | `GET /api/v1/payments/callback/?transaction_id=...&ref=...&status=ok` → باید redirect شود | ☐ |
| 9.3 | وضعیت تراکنش | `GET /api/v1/payments/transactions/<id>/` | ☐ |
| 9.4 | صفحه بازگشت از درگاه | باز شدن `/payment/return?transaction_id=...&status=...` | ☐ |

## ۱۰. کنترل دسترسی (RBAC)

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 10.1 | نقش‌ها بدون تغییر کد | `GET /api/v1/access/roles/` | ☐ |
| 10.2 | مجوزها | `GET /api/v1/access/permissions/` | ☐ |
| 10.3 | تخصیص نقش به کاربر | `POST /api/v1/access/users/<id>/roles/` | ☐ |
| 10.4 | 401 برای درخواست بدون توکن | فراخوانی API بدون Authorization | ☐ |
| 10.5 | 403 برای نقش بدون دسترسی | کاربر با نقش محدود | ☐ |

## ۱۱. اصول REST و Swagger

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 11.1 | Swagger در /api/docs/ | باز کردن در مرورگر | ☐ |
| 11.2 | مثال request/response در Swagger | بررسی docs | ☐ |
| 11.3 | کدهای HTTP صحیح | 200, 201, 400, 401, 403, 404 | ☐ |

## ۱۲. Docker و تست‌ها

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 12.1 | Docker Compose | `cd infra && docker compose up -d` | ☐ |
| 12.2 | حداقل ۵ تست بک‌اند | `python manage.py test` | ☐ |
| 12.3 | حداقل ۵ تست فرانت | `npm test` | ☐ |

---

# چک‌پوینت ۲ — فرانت‌اند

## ۱. صفحات اصلی

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 1.1 | صفحه اصلی (لندینگ) | / | حداقل ۳ آمار (حل‌شده، کارمندان، فعال) | ☐ |
| 1.2 | ورود | /login | فرم ورود با شناسه و رمز | ☐ |
| 1.3 | ثبت‌نام | /register | فرم ثبت‌نام | ☐ |

## ۲. داشبورد ماژولار

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 2.1 | داشبورد اصلی | /dashboard | ماژول‌ها بر اساس نقش | ☐ |
| 2.2 | کارآگاه: ماژول تخته کارآگاه | /dashboard/detective | وجود لینک | ☐ |
| 2.3 | پزشک قانونی: بدون تخته کارآگاه | ورود با نقش coroner | ☐ |
| 2.4 | دسترسی سریع (پرونده، گزارش، تحت تعقیب، مدارک) | داشبورد | کلیک روی لینک‌ها | ☐ |

## ۳. تخته کارآگاهی

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 3.1 | Drag & Drop آیتم‌ها | کشیدن و رها کردن | ☐ |
| 3.2 | اتصال مدارک با خط قرمز | رها کردن روی هم برای لینک | ☐ |
| 3.3 | حذف و اضافه خطوط | قابلیت ویرایش | ☐ |
| 3.4 | خروجی تصویر (PNG) | دکمه export | ☐ |

## ۴. تحت تعقیب شدید

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 4.1 | لیست مظنونین تحت تعقیب | /dashboard/wanted | نمایش با جزئیات | ☐ |
| 4.2 | رتبه‌بندی صحیح | مطابق فرمول max(Lj)·max(Di) | ☐ |
| 4.3 | پاداش هر شخص | max(Lj)·max(Di)·20,000,000 ریال | ☐ |

## ۵. وضعیت پرونده‌ها و شکایات

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 5.1 | لیست پرونده‌ها | /dashboard/cases | مشاهده و وضعیت | ☐ |
| 5.2 | دسترسی بر اساس نقش | ورود با نقش‌های مختلف | ☐ |

## ۶. گزارش‌گیری کلی

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 6.1 | گزارش کلی هر پرونده | /dashboard/reports | تاریخ، شواهد، مظنونین، مجرم، شاکی، افراد دخیل | ☐ |
| 6.2 | نمایش برای قاضی/کاپیتان/رئیس | دسترسی نقش‌محور | ☐ |

## ۷. ثبت و بررسی مدارک

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 7.1 | فرم ثبت ۵ نوع مدرک | /dashboard/evidence | استشهاد، زیستی، خودرو، شناسایی، سایر | ☐ |
| 7.2 | تأیید پزشکی‌قانونی (بیولوژیک) | صفحه تأیید coroner | ☐ |
| 7.3 | لینک مدارک | اتصال مدارک به هم | ☐ |

## ۸. پنل ادمین

| # | قابلیت | آدرس | روش تست | وضعیت |
|---|--------|-------|---------|-------|
| 8.1 | مدیریت نقش‌ها و کاربران | /dashboard/admin | فقط is_staff | ☐ |
| 8.2 | عملکرد مشابه Django Admin | افزودن/حذف/تغییر نقش | ☐ |

## ۹. UX و رفتار

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 9.1 | Skeleton / حالت بارگذاری | باز کردن صفحات دارای fetch | ☐ |
| 9.2 | نمایش پیام خطای مناسب | خطای شبکه، 401، 403 | ☐ |
| 9.3 | صفحات واکنش‌گرا (Responsive) | تغییر اندازه پنجره | ☐ |
| 9.4 | چرخه حیات کامپوننت‌ها | unmount تمیز، بدون memory leak | ☐ |

## ۱۰. Docker و تست فرانت

| # | قابلیت | روش تست | وضعیت |
|---|--------|---------|-------|
| 10.1 | Docker Compose کل پروژه | یک compose برای backend+frontend+db | ☐ |
| 10.2 | حداقل ۵ تست فرانت | `npm test` | ☐ |
| 10.3 | مدیریت state مناسب | AuthContext، عدم تناقض | ☐ |

---

# خلاصه دستورات تست

```bash
# بک‌اند
cd backend && python manage.py test

# فرانت
cd frontend && npm test

# Docker
cd infra && docker compose up -d
```

---

# نتایج آخرین اجرای تست (خودکار)

**تاریخ:** بهمن ۱۴۰۴

## بک‌اند
- **۱۰۱ تست** — همه موفق ✅
- شامل: `apps.reports.tests_checklist` (۱۴ تست چک‌لیست) + تست‌های سایر apps

## فرانت‌اند
- **۱۳ تست** — همه موفق ✅
- شامل: Home، Login، Register، ErrorDisplay، Skeleton، LoadingSpinner، API

## پوشش تست خودکار نسبت به چک‌لیست

| بخش چک‌لیست | پوشش تست خودکار |
|-------------|-------------------|
| ۱. آمار عمومی | ✅ `test_1_1_landing_stats`, `test_1_2_required_fields` |
| ۲. ثبت‌نام و ورود | ✅ identity/tests + checklist |
| ۳. تشکیل پرونده | ✅ cases/tests (شکایت، صحنه، تأیید، transition) |
| ۴. ثبت شواهد | ⚠️ evidence model tests؛ API نیاز به تست دستی |
| ۵. حل پرونده و تحقیقات | ✅ investigation/tests (reasoning، assessment، arrest) |
| ۶. محاکمه | ✅ judiciary/tests |
| ۷. تحت تعقیب | ✅ wanted/tests + checklist |
| ۸. پاداش | ✅ rewards/tests |
| ۹. پرداخت | ✅ payments/tests + checklist |
| ۱۰. RBAC | ✅ access/tests + checklist |
| ۱۱. Swagger | ✅ `test_11_1_swagger_schema` |
| فرانت: صفحات اصلی | ✅ Home، Login، Register |
| فرانت: UX | ✅ Skeleton، ErrorDisplay |

**توجه:** مواردی مثل Drag&Drop تخته کارآگاه، صفحات واکنش‌گرا و تست دستی Docker نیاز به بررسی دستی دارند.

---

*این چک‌لیست بر اساس PDF پروژه WP-F2025 و چک‌پوینت‌های ۱ و ۲ تهیه شده است.*
