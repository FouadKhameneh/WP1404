# گزارش نهایی پروژه — سامانه یکپارچه عملیات دیجیتال پلیس

**نام پروژه:** Police Digital Operations System (PDOS)  
**درس:** پروژه برنامه‌نویسی وب — WP-F2025  
**تاریخ:** بهمن ۱۴۰۴

---

## ۱. خلاصه اجرایی

این پروژه یک سامانه یکپارچه برای دیجیتال‌سازی عملیات پلیس است که فرآیندهای ثبت شکایت، تشکیل پرونده، جمع‌آوری شواهد، تحقیقات، ارجاع به قضایی، محاکمه و پرداخت را پوشش می‌دهد. پروژه به‌صورت **Monorepo** شامل بک‌اند (Django REST Framework)، فرانت‌اند (Next.js) و زیرساخت (Docker Compose) است.

---

## ۲. معماری پروژه

### ۲.۱ ساختار کلی

```
WP1404/
├── backend/          # سرویس API با Django REST Framework
├── frontend/         # اپلیکیشن وب با Next.js
├── infra/           # Docker و پیکربندی زیرساخت
├── docs/            # مستندات
├── scripts/         # اسکریپت‌های توسعه و اتوماسیون
└── TESTING.md       # راهنمای تست
```

### ۲.۲ بک‌اند — Django REST Framework

| فناوری | نسخه |
|--------|------|
| Django | 6.0 |
| Django REST Framework | 3.16 |
| drf-spectacular | 0.28 (Swagger/OpenAPI) |
| PostgreSQL | 16 (در Docker) |
| Celery | 5.4 |
| Redis | 7 |

**ماژول‌های دامنه (Apps):**

| App | مسئولیت |
|-----|---------|
| **identity** | احراز هویت (ثبت‌نام، ورود، خروج)، توکن |
| **access** | RBAC (نقش‌ها، مجوزها، تخصیص نقش به کاربر) |
| **cases** | پرونده‌ها، شکایات، گزارش صحنه جرم، روند تشکیل پرونده |
| **evidence** | شواهد (استشهاد، زیستی، خودرو، شناسایی، سایر)، لینک‌ها، تأیید پزشکی‌قانونی |
| **investigation** | ارزیابی مظنونین، استدلال‌ها، دستور بازداشت/بازجویی |
| **judiciary** | رأی محاکمه، ثبت مجازات |
| **wanted** | لیست تحت تعقیب و Most Wanted |
| **rewards** | نکات پاداش، تأیید ادعا، محاسبه رتبه و پاداش |
| **payments** | پرداخت ضمانت/جریمه (درگاه پرداخت، callback، وضعیت تراکنش) |
| **reports** | آمار صفحه اصلی، گزارش کلی، رتبه‌بندی |
| **notifications** | Audit log، رویدادهای Timeline، وظایف زمان‌بندی‌شده |

### ۲.۳ فرانت‌اند — Next.js

| فناوری | نسخه |
|--------|------|
| Next.js | 14.2 |
| React | 18.3 |
| TypeScript | 5.6 |
| Jest | 29.7 |
| html-to-image | 1.11 (برای export بورد کارآگاه به تصویر) |

**صفحات اصلی:**

| مسیر | توضیح |
|------|-------|
| `/` | صفحه اصلی (لندینگ)، آمار عمومی |
| `/login` | ورود |
| `/register` | ثبت‌نام |
| `/dashboard` | داشبورد اصلی با آمار و دسترسی سریع |
| `/dashboard/cases` | وضعیت پرونده‌ها و شکایات |
| `/dashboard/detective` | تخته کارآگاهی (Drag & Drop، لینک، export PNG) |
| `/dashboard/evidence` | ثبت و بررسی مدارک (۵ نوع شواهد) |
| `/dashboard/wanted` | تحت تعقیب‌ها |
| `/dashboard/reports` | گزارش‌گیری کلی |
| `/dashboard/admin` | پنل ادمین (مدیریت نقش و کاربر) |
| `/payment/return` | صفحه بازگشت از درگاه پرداخت |

---

## ۳. ویژگی‌های پیاده‌سازی‌شده

### ۳.۱ چک‌پوینت ۱ — بک‌اند

| مورد | وضعیت | توضیح |
|------|-------|-------|
| مدل‌های منطقی | ✅ | Case، CaseParticipant، Complaint، Evidence، Wanted، PaymentTransaction، RewardTip و غیره |
| Endpointهای REST | ✅ | بیش از ۴۰ endpoint در ۱۱ app |
| CRUD APIها | ✅ | پرونده، شکایت، شواهد، مظنونین، پرداخت، پاداش |
| اصول REST | ✅ | GET، POST، PUT، PATCH، DELETE با کدهای HTTP مناسب |
| RBAC | ✅ | Role، Permission، HasRBACPermissions، endpointهای access |
| روند ثبت‌نام و ورود | ✅ | register، login، logout، me |
| روند تشکیل پرونده | ✅ | شکایت، صحنه جرم، approve |
| روند ثبت شواهد | ✅ | ۵ نوع: استشهاد، زیستی، خودرو، شناسایی، سایر + coroner |
| روند حل پرونده | ✅ | transition-status، Captain/Chief |
| شناسایی مظنونین | ✅ | suspects، assessments، scores |
| محاکمه | ✅ | verdict، punishment |
| وضعیت مظنونین | ✅ | wanted، most_wanted |
| پاداش | ✅ | tips، review، verify-claim |
| پرداخت | ✅ | initiate، callback (redirect به فرانت)، status API |
| Swagger | ✅ | /api/docs/، /api/redoc/، /api/schema/ |
| Docker | ✅ | backend، frontend، postgres، redis، worker، beat |
| مستند Swagger | ✅ | با مثال‌های request/response |
| تغییرپذیری نقش‌ها | ✅ | بدون تغییر کد، از migration و access |
| صفحه بازگشت پرداخت | ✅ | redirect به /payment/return?transaction_id=&status= |
| آمار مجتمع و کلی | ✅ | homepage، general، wanted-rankings، approvals |

### ۳.۲ چک‌پوینت ۲ — فرانت‌اند

| مورد | وضعیت | توضیح |
|------|-------|-------|
| صفحه اصلی | ✅ | آمار عمومی، دکمه‌های ورود و ثبت‌نام |
| ورود و ثبت‌نام | ✅ | فرم‌های فارسی |
| داشبورد ماژولار | ✅ | navigation بر اساس نقش کاربر |
| تخته کارآگاه | ✅ | Drag & Drop، لینک آیتم‌ها، export PNG |
| تحت تعقیب | ✅ | لیست و وضعیت مظنونین |
| وضعیت پرونده‌ها | ✅ | لیست پرونده‌ها با وضعیت |
| گزارش‌گیری کلی | ✅ | جداول، آمار، JSON |
| ثبت و بررسی مدارک | ✅ | فرم ۵ نوع مدرک، تأیید پزشکی‌قانونی |
| پنل ادمین | ✅ | مدیریت نقش و کاربر |
| Skeleton Layout | ✅ | حالت بارگذاری با اسکلت در داشبورد و پرونده‌ها |
| Docker Compose | ✅ | یک compose برای کل پروژه |
| مدیریت state | ✅ | AuthContext، api client |
| نمایش پیام خطا | ✅ | ErrorDisplay |
| Best practices | ✅ | کامپوننت‌های قابل استفاده مجدد |

---

## ۴. APIهای اصلی

### ۴.۱ احراز هویت (Identity)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| POST | `/api/v1/identity/auth/register/` | ثبت‌نام |
| POST | `/api/v1/identity/auth/login/` | ورود |
| POST | `/api/v1/identity/auth/logout/` | خروج |
| GET | `/api/v1/identity/auth/me/` | کاربر جاری |

### ۴.۲ دسترسی (Access)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| GET | `/api/v1/access/roles/` | لیست نقش‌ها |
| GET | `/api/v1/access/permissions/` | لیست مجوزها |
| GET/POST | `/api/v1/access/users/<id>/roles/` | نقش‌های کاربر |

### ۴.۳ پرونده‌ها (Cases)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| GET | `/api/v1/cases/cases/` | لیست پرونده‌ها |
| GET | `/api/v1/cases/cases/<id>/` | جزئیات پرونده |
| POST | `/api/v1/cases/complaints/` | ثبت شکایت |
| POST | `/api/v1/cases/scene-cases/` | تشکیل پرونده صحنه جرم |
| POST | `/api/v1/cases/cases/<id>/transition-status/` | تغییر وضعیت پرونده |
| POST | `/api/v1/cases/cases/<id>/suspects/` | افزودن مظنون |

### ۴.۴ شواهد (Evidence)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| GET | `/api/v1/evidence/cases/?case_id=<id>` | شواهد پرونده |
| POST | `/api/v1/evidence/cases/create/` | ثبت شواهد |
| POST | `/api/v1/evidence/biological/<id>/coroner-decision/` | تأیید پزشکی‌قانونی |

### ۴.۵ تحقیقات (Investigation)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| GET/POST | `/api/v1/investigation/assessments/` | ارزیابی مظنون |
| POST | `/api/v1/investigation/reasonings/` | ارسال استدلال |
| POST | `/api/v1/investigation/arrest-orders/` | دستور بازداشت |

### ۴.۶ پرداخت (Payments)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| POST | `/api/v1/payments/initiate/` | شروع پرداخت |
| GET | `/api/v1/payments/callback/` | Callback درگاه (redirect) |
| GET | `/api/v1/payments/transactions/<id>/` | وضعیت تراکنش |

### ۴.۷ گزارش‌ها (Reports)

| Method | Endpoint | توضیح |
|--------|----------|-------|
| GET | `/api/v1/reports/landing-stats/` | آمار صفحه اصلی (عمومی) |
| GET | `/api/v1/reports/homepage/` | آمار داشبورد |
| GET | `/api/v1/reports/general/` | گزارش کلی |
| GET | `/api/v1/reports/wanted-rankings/` | رتبه‌بندی تحت تعقیب |

---

## ۵. اجرا و تست

### ۵.۱ اجرای محلی

**بک‌اند:**
```bash
cd backend
pip install -r requirements.txt
python manage.py migrate
python manage.py runserver 0.0.0.0:8000
```

**ایجاد دیتای تست:**
```bash
python manage.py seed_test_data
```

**فرانت‌اند:**
```bash
cd frontend
npm install
# PowerShell:
$env:NEXT_PUBLIC_API_BASE_URL="http://localhost:8000/api/v1"
npm run dev
```

**با Docker:**
```bash
cd infra
cp .env.example .env
docker compose up -d
```

### ۵.۲ آدرس‌های مهم

| سرویس | آدرس |
|-------|------|
| فرانت‌اند | http://localhost:3000 |
| بک‌اند API | http://localhost:8000/api/v1/ |
| Swagger | http://localhost:8000/api/docs/ |
| Django Admin | http://localhost:8000/admin/ |

### ۵.۳ اعتبار ورود تست

| کاربر | رمز | نقش |
|-------|-----|-----|
| admin | admin123 | ادمین |
| detective1 | test1234 | کارآگاه |
| shaki1 | test1234 | شاکی |
| سایر | test1234 | — |

### ۵.۴ نتایج تست

| بخش | تعداد تست | وضعیت |
|-----|-----------|-------|
| بک‌اند | ۸۷ | ✅ OK |
| فرانت‌اند | ۱۲ | ✅ OK |

**دستورات اجرای تست:**
- بک‌اند: `python manage.py test`
- فرانت‌اند: `npm test`

---

## ۶. امنیت و دسترسی

- **احراز هویت:** Token-based (Django REST Framework Token)
- **کنترل دسترسی:** RBAC با Role و Permission
- **CORS:** پیکربندی برای فرانت‌اند
- **تنظیمات امنیتی:** HSTS، SSL redirect (در production)

---

## ۷. جمع‌بندی

پروژه **سامانه یکپارچه عملیات دیجیتال پلیس** با پوشش چک‌پوینت‌های ۱ و ۲ آماده تحویل است. بک‌اند با Django REST Framework، فرانت‌اند با Next.js و زیرساخت با Docker Compose پیاده‌سازی شده و تمام الزامات مورد نیاز (مدل‌ها، endpointها، RBAC، Swagger، صفحه بازگشت پرداخت، Skeleton Layout، تست‌ها) برآورده شده‌اند.

---

*تهیه‌شده بر اساس کد و مستندات پروژه WP-F2025*
